# Plan: Phase 06 - Interactive Python Sandbox (Live Research & Modeling)

## Objective
Integrate a production-grade, NPU-accelerated Docker sandbox for secure, custom code execution within the agentic swarm. This enables complex mathematical modeling (Monte Carlo, custom TA) directly from the chat interface.

## Success Criteria
- [ ] Docker MCP server verified and stable.
- [ ] `DecisionAgent` successfully delegates math-heavy tasks to the Docker sandbox.
- [ ] Support for MLX/CoreML accelerated calculations within containers (on Apple Silicon).
- [ ] Documentation updated (ARCHITECTURE.md, README.md).
- [ ] Phase 04 test suite debt reduced (remaining failures addressed).

## Phase 06-01: Foundation & Verification
**Goal**: Ensure the Docker MCP infrastructure is robust and integrated.

### 1. Docker MCP Verification
- Run integration tests for `backend/docker_mcp_server.py`.
- Verify resource limits (CPU/Memory) and timeout mechanisms.
- **Task**: Create `backend/tests/test_docker_mcp.py`.

### 2. NPU-Accelerated Engine Setup
- Define/Pull the specialized `growin-npu-compute` image if available, or fallback to standard python-slim with MLX instructions.
- Test the `engine="npu"` flag in `docker_run_python` to ensure it identifies ANE/GPU.

### 3. Agentic Loop Hardening
- Update `DecisionAgent` system prompt to explicitly mention the `docker_run_python` tool for "Simulations, Modeling, and Data Cleansing".
- Ensure `DecisionAgent` knows how to interpret sandbox outputs.

## Phase 06-02: Live Simulations (Live Research)
**Goal**: Enable high-value trading simulations.

### 1. Monte Carlo Strategy
- Create a template/prompt for the agent to generate Monte Carlo simulation code.
- Verify the agent can execute it and summarize results (e.g., "95% Confidence Interval for TSLA in 30 days").

### 2. Custom Technical Analysis
- Enable users to ask for non-standard indicators (e.g., "Calculate a 14-period Ichimoku Cloud manually").

## Phase 06-03: Documentation & Debt
**Goal**: Finalize Phase 06 and clean up legacy issues.

### 1. Update Architecture Docs
- Reflect the shift from `SafePythonExecutor` (AST-based) to Docker-based execution.
- Update `IMPROVEMENTS.md` and `TODO.md`.

### 2. Test Suite Resuscitation
- Fix the 42 residual test failures from Phase 04.
- Standardize all tests to use `uv run pytest`.

## Implementation Details
- **Tool**: `docker_run_python(script: str, timeout: int, engine: str)`
- **Sandbox Isolation**: Network disabled, memory limit 128MB-256MB.
- **Persistence**: Temporary containers only (`--rm`).
