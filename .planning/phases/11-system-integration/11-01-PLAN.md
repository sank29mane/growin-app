---
phase: 11-system-integration
plan: 01
type: execute
wave: 1
depends_on: ["10-04"]
files_modified: [
    "backend/tests/test_ai_streaming.py",
    "backend/tests/test_rstitch_logic.py",
    "GrowinTests/AIStrategyTests.swift",
    "pyproject.toml"
]
autonomous: true
requirements: [SYS-01, SYS-02, SYS-03]
---

<objective>
Initialize the automated testing framework and implement core unit tests for SOTA AG-UI streaming and R-Stitch logic, including edge-case verification for network resilience and entropy-guided routing.
</objective>

<tasks>

<task type="auto" status="completed">
  <name>Task 1: Initialize Backend Test Automation Framework</name>
  <action>
    - Ensure `pytest` and `pytest-asyncio` are configured in `pyproject.toml`.
    - **SOTA Task**: Install and configure **DeepEval** for AI reasoning trace evaluation.
    - Create a base test suite for the new `ai_routes.py`.
  </action>
</task>

<task type="auto" status="completed">
  <name>Task 2: Implement SSE & R-Stitch Unit Tests</name>
  <action>
    - **SOTA Task**: Create `backend/tests/test_ai_streaming.py` to verify SSE stability:
        - Test `X-Accel-Buffering: no` header presence.
        - Test generator behavior for recoverable vs non-recoverable errors.
    - **SOTA Task**: Create `backend/tests/test_rstitch_logic.py` to verify entropy routing:
        - Mock SLM/LLM outputs with varying entropy scores.
        - Assert correct model delegation based on configured thresholds.
    - Test boundary values for `InstrumentWeight` and `AIStrategyResponse`.
  </action>
</task>

<task type="auto" status="completed">
  <name>Task 3: Implement Frontend Resilience Unit Tests</name>
  <action>
    - **SOTA Task**: Update `GrowinTests/AIStrategyTests.swift` with:
        - Mocked "Network Drop" simulation to verify session resumption with `session_id`.
        - Expanded Optimistic UI rollback tests with varying failure reasons (Margin, Validation, Connection).
        - Verification of `ConfidenceIndicator` visual state mapping.
  </action>
</task>

</tasks>

<verification>
- **Backend**: Run `uv run pytest backend/tests/test_ai_streaming.py backend/tests/test_rstitch_logic.py` and ensure all pass.
- **Frontend**: Execute `AIStrategyTests` in Xcode and verify 100% pass rate.
- **Coverage**: Verify that new SOTA routes and logic have >90% unit test coverage.
</verification>
