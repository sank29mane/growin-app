---
phase: 05-research-augmentation
plan: 03
type: execute
wave: 3
depends_on: [05-02]
files_modified: [backend/rag_manager.py, backend/agents/decision_agent.py, .planning/STATE.md]
autonomous: true
requirements: [RG-01, RG-02, RG-03]
must_haves:
  truths:
    - "DecisionAgent can reason about abstract portfolio trends using deep RAG (e.g., 'Why is my portfolio flat?')"
    - "RAG context injection handles broader market trends for abstract queries"
    - "System shows measurable TTFT reduction (aiming for 5.8x improvement)"
  artifacts:
    - path: "backend/rag_manager.py"
      provides: "Enhanced RAG for abstract reasoning"
    - path: "backend/agents/decision_agent.py"
      provides: "Expanded context injection"
  key_links:
    - from: "backend/agents/decision_agent.py"
      to: "backend/rag_manager.py"
      via: "query"
---

<objective>
Enhance the knowledge base with deep financial RAG for abstract reasoning and verify the overall Phase 5 performance and quality gains.

Purpose: Higher-quality, data-backed abstract reasoning for complex portfolio queries.
Output: Integrated RAG and verified performance optimizations.
</objective>

<execution_context>
@/Users/sanketmane/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@backend/rag_manager.py
@backend/agents/decision_agent.py
@.planning/STATE.md
@.gsd/ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deep Financial RAG for Abstract Reasoning</name>
  <files>backend/rag_manager.py, backend/agents/decision_agent.py</files>
  <action>
    - Seed `RAGManager` with representative abstract financial context (e.g., correlations, sector rotation, inflation effects).
    - Update `DecisionAgent._inject_context_layers` to prioritize abstract market trends when a query is non-ticker-specific (e.g., "Why is my portfolio flat?").
    - Ensure RAG results provide deeper context than just historical trades.
  </action>
  <verify>Query 'Why is my portfolio flat?' and check if RAG injects market context.</verify>
  <done>Decision Agent can answer abstract portfolio questions with RAG support.</done>
</task>

<task type="auto">
  <name>Task 2: Performance Verification (TTFT & Batching)</name>
  <files>backend/lm_studio_client.py</files>
  <action>
    - Run a performance benchmark comparing the new `LMStudioClient` (with prefix caching) vs old performance logs.
    - Measure Time-To-First-Token (TTFT) for repeated system prompts.
    - Verify concurrent request safety and 60% RAM rule compliance.
  </action>
  <verify>Log TTFT and concurrency metrics during test runs.</verify>
  <done>System demonstrates measurable performance improvement (Target: up to 5.8x TTFT reduction).</done>
</task>

<task type="auto">
  <name>Task 3: State & Roadmap Finalization</name>
  <files>.planning/STATE.md, .gsd/ROADMAP.md</files>
  <action>
    - Update `.planning/STATE.md` to show Phase 5 completion.
    - Update `.gsd/ROADMAP.md` to reflect Phase 5 as COMPLETED.
    - Update `STATE.md` to transition to Phase 6: Interactive Python Sandbox.
  </action>
  <verify>Check ROADMAP and STATE files for current phase/status.</verify>
  <done>Project state is up-to-date.</done>
</task>

</tasks>

<verification>
Check for:
1. RAG query results for abstract queries.
2. Performance metrics in logs.
3. Updated roadmap and state files.
</verification>

<success_criteria>
- Abstract queries receive well-reasoned, context-backed answers.
- Phase 5 is marked as complete in project state.
</success_criteria>

<output>
After completion, create `.planning/phases/05-research-augmentation/05-03-SUMMARY.md`
</output>
