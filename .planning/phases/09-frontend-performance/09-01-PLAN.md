---
phase: 09-frontend-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: ["Growin/ThemeComponents.swift", "Growin/Views/PortfolioView.swift", "Growin/ContentView.swift", "Growin/Services/MetalChartRenderer.swift", "Growin/Utils/HapticFeedbackManager.swift"]
autonomous: true
requirements: [FE-01]
---

<objective>
Optimize the SwiftUI frontend for 120Hz smoothness by implementing Metal-backed charts, ensuring main-thread isolation, and leveraging optimistic UI with haptics, informed by SOTA fintech UI/UX research.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Optimize Glassmorphic Rendering & Mesh Background</name>
  <action>
    - Review `ThemeComponents.swift` for `GlassCard` and `MeshBackground` implementation.
    - Implement `drawingGroup()` for static background elements like `MeshBackground` to offload rendering to Metal, ensuring it doesn't starve the main thread.
    - Consolidate and reduce redundant `blur` and `opacity` layers in `GlassCard` to minimize excessive off-screen rendering.
  </action>
</task>

<task type="auto">
  <name>Task 2: Implement Metal-Backed SwiftUI Charts</name>
  <action>
    - For `PerformanceLineChart` and other core financial charts in `PortfolioView.swift`, investigate bridging native Metal compute shaders with SwiftUI via `UIViewRepresentable`.
    - Implement a dual-pipeline rendering approach: one for visual representation (candlesticks, lines) and another for heavy technical indicator calculations (RSI, Bollinger Bands) entirely on the GPU.
    - Create new files (e.g., `Growin/Services/MetalChartRenderer.swift`) for Metal integration.
  </action>
</task>

<task type="auto">
  <name>Task 3: Ensure Main-Thread Isolation</name>
  <action>
    - Audit `PortfolioViewModel` and `ChatViewModel` for any data fetching, AI reasoning, or stream parsing (SSE/WebSockets) occurring on the main thread.
    - Offload all heavy computations and data operations to background `Task`s or `Actors` to ensure the SwiftUI main thread remains unblocked for 120 FPS interactions.
  </action>
</task>

<task type="auto">
  <name>Task 4: Implement Optimistic State Management & Haptics</name>
  <action>
    - For actions like trade execution or portfolio updates, leverage SwiftUI's `@State` and `@Binding` to instantly reflect changes locally before server confirmation.
    - Integrate custom `CoreHaptics` feedback to provide tactile confirmation pulses for significant user actions (e.g., order submission), enhancing the "Physiological Feedback Loops" as per research.
    - Create a utility (e.g., `Growin/Utils/HapticFeedbackManager.swift`) for standardized haptic patterns.
  </action>
</task>

<task type="auto">
  <name>Task 5: Scroll Performance Hardening & Hierarchy Flattening</name>
  <action>
    - Update `PortfolioView.swift` and `ChatView` to utilize efficient lazy loading mechanisms for lists and grids.
    - Analyze and flatten complex view hierarchies in list items to reduce layout calculation overhead.
    - Ensure all animations utilize `.spring()` modifier with appropriate damping for fluid, hitch-free transitions, particularly in data-intensive views.
  </action>
</task>

</tasks>

<verification>
- **Xcode Instruments Profiling**: Verify consistent 120fps (or closest possible) on ProMotion displays for key interactions (scrolling, chart manipulation, UI transitions).
- **Code Review**: Ensure `MetalChartRenderer.swift` and `HapticFeedbackManager.swift` are correctly integrated and main-thread operations are minimized.
- **Visual Inspection**: Confirm smooth animations, optimistic UI feedback, and appropriate haptic responses.
</verification>
