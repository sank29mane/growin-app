---
phase: 10-frontend-stitch-integration
plan: 02
type: execute
wave: 1
depends_on: ["10-01"]
files_modified: [
    "Growin/CoreModels.swift",
    "Growin/ViewModels/DashboardViewModel.swift",
    "Growin/ViewModels/ReasoningTraceViewModel.swift",
    "backend/schemas.py",
    "backend/routes/ai_routes.py" # Assuming a new route file or existing one for AI interactions
]
autonomous: true
requirements: [FE-07, FE-08]
---

<objective>
Outline necessary API endpoints and specify the state management strategy for dynamic UI components, particularly for the AI Recovery Strategy, Reasoning Trace, and Challenge Logic interfaces.
</objective>

<tasks>

<task type="auto" status="completed">
  <name>Task 1: Outline New/Modified API Endpoints with SOTA Streaming</name>
  <action>
    - Review the data requirements for the AI Recovery Strategy, Expanded Reasoning Trace, and Challenge Logic screens.
    - **SOTA Task**: Implement **AG-UI Streaming Protocol** using Server-Sent Events (SSE) in a new `backend/routes/ai_routes.py`.
    - **SOTA Task**: Define endpoints for streaming `AgentEvent` objects to reflect real-time agent "thoughts" (e.g., `/api/ai/strategy/stream`).
    - **SOTA Task**: Implement **R-Stitch** logic to dynamically delegate between SLM (for initial status) and LLM (for deep reasoning) to minimize UI latency.
    - Propose schema updates in `backend/schemas.py` for `AIStrategyResponse` and `AgentEvent`.
  </action>
</task>

<task type="auto" status="completed">
  <name>Task 2: Specify Frontend State Management with Optimistic UI</name>
  <action>
    - Design ViewModels (`AIStrategyViewModel`, `ReasoningTraceViewModel`) using SwiftUI's `@Observable` or `@Published`.
    - **SOTA Task**: Implement **Optimistic UI** state management for strategy adjustments and challenge logic, allowing immediate UI feedback before backend confirmation.
    - **SOTA Task**: Implement a **Graceful Rollback** mechanism in the ViewModel to handle failed strategy updates with user-friendly error states.
    - Define how `EventSource` (or equivalent) will be used to observe the AG-UI stream and update the `reasoningTrace` in real-time.
    - Specify how user interactions will update state and trigger R-Stitch-optimized API calls.
  </action>
</task>

</tasks>

<verification>
- **API Endpoint Specification**: Ensure all required data for the new UI is covered by proposed API endpoints and schemas.
- **State Management Design**: Verify that ViewModels are clearly defined with appropriate `@Published` properties to manage UI state and interactions.
- **Internal Review**: Review proposed API endpoints and state management against the Stitch designs and overall architectural principles.
</verification>
