---
phase: 18-adversarial-alpha
plan: 03
type: execute
wave: 3
depends_on: [18-02]
files_modified: [backend/analytics_db.py, backend/agents/orchestrator_agent.py]
autonomous: true
requirements: [ADV-03]

must_haves:
  truths:
    - "Agent reasoning traces are correlated with price action in AnalyticsDB"
    - "An 'Agent Alpha' score is computed for the Orchestrator"
  artifacts:
    - path: "backend/analytics_db.py"
      provides: "Agent Alpha correlation queries and Alpha table"
    - path: "backend/agents/orchestrator_agent.py"
      provides: "Final Alpha-aware reporting"
  key_links:
    - from: "Agent Telemetry"
      to: "Historical Price Data"
      via: "DuckDB SQL join"
    - from: "Price Action"
      to: "Alpha Score"
      via: "Forward 1-day/5-day return calculation"
---

<objective>
Implement the Historical Alpha Audit by correlating agent reasoning traces with price action to measure agent performance (Agent Alpha).

Purpose: Quantify the value-add of agent intelligence.
Output: Alpha Audit queries in AnalyticsDB and an Alpha performance reporting system.
</objective>

<execution_context>
@/Users/sanketmane/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/sanketmane/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/analytics_db.py
@.gsd/RESEARCH_PHASE_18.md
@.planning/phases/18-adversarial-alpha/18-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: AnalyticsDB Agent Alpha Correlation</name>
  <files>backend/analytics_db.py</files>
  <action>
    - Add a new table `agent_performance` to store correlated alpha scores.
    - Implement `calculate_agent_alpha(ticker, correlation_id)` which:
        - Finds the `reasoning_started` telemetry for a ticker.
        - Joins with `ohlcv_history` to get price at `timestamp`.
        - Fetches price at `timestamp + 1 day` and `timestamp + 5 days`.
        - Calculates the return and stores it as an "Alpha Result".
    - Create a bulk audit method to process all historical telemetry.
  </action>
  <verify>
    Run a test script that triggers a reasoning trace, then manually verify the 'agent_performance' table contains a row with the ticker and a return calculation (if price data exists).
  </verify>
  <done>
    AnalyticsDB can correlate agent traces with future price action to measure Alpha.
  </done>
</task>

<task type="auto">
  <name>Task 2: Agent Alpha Reporting & Metrics</name>
  <files>backend/analytics_db.py, backend/agents/orchestrator_agent.py</files>
  <action>
    - Expose a method `get_overall_agent_alpha()` that returns the hit rate (accuracy) and average return of agent suggestions.
    - Update OrchestratorAgent to optionally log its final 'Alpha Context' (previous performance on this ticker) to the current reasoning.
  </action>
  <verify>
    Verify the Orchestrator can access its 'Historical Alpha' when starting a new analysis for a known ticker.
  </verify>
  <done>
    Agent performance is tracked and used to weight future reasoning.
  </done>
</task>

</tasks>

<verification>
Check the DuckDB `agent_performance` table for valid alpha data.
</verification>

<success_criteria>
The system can report the Orchestrator's historical accuracy and average returns across its suggested trades.
</success_criteria>

<output>
After completion, create `.planning/phases/18-adversarial-alpha/18-03-SUMMARY.md`
</output>
