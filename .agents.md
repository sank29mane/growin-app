# Growin App: Architectural Learnings & Optimization Log

## üìç Architecture Resilience (Data Sourcing)
- **Mandate:** Absolute partitioning of data sources by region.
- **Resilient Strategy (Implemented 2026-02-23):**
    - **US Stocks:** Alpaca API (Primary) ‚Üí yfinance (Fallback).
    - **UK/LSE Stocks:** Finnhub (Primary) ‚Üí yfinance (Fallback).
    - **Global Fallback:** Yahoo Finance (yfinance) integrated as the universal mandatory backup.
- **Benefit:** Guarantees data provenance while ensuring the UI never shows "Empty" state if a specific provider is down.

## üß† Decision Model Evolution
- **Persona:** Elevated to "Elite Profit-Driven Trading Advisor" (Senior, Profit-Maximising, Approachable).
- **Consultation Flow:** Decision Model is now the client-facing primary. It explicitly consults the `CoordinatorAgent` for multi-specialist insights (Quant, Forecast, Research) before synthesizing a final recommendation.
- **Advanced Capabilities:**
    - **Parallel Multi-Model Burst:** Exploits LM Studio 0.4.0+ continuous batching to trigger multiple specialist agents in parallel.
    - **NPU-Accelerated Sandbox:** Utilizes `engine: "npu"` to offload heavy mathematical modeling to the Apple Neural Engine (ANE) via specialized Docker containers.
    - **RAG Memory & Timeline:** Implemented Chat History Memory and time-stamped News Insights Timeline within ChromaDB for semantic retrieval of past reasoning and sentiment trends.

## ‚ö° Blazing Fast Performance & Efficiency
- **Caching (L1/L2):** 
    - L1: In-memory `OrderedDict`.
    - L2: `Redis` integration for persistent, shared cross-request caching.
    - **Learning:** On Apple Silicon (M4 Pro), keeping model weights and KV cache within 60% of physical RAM is critical to avoid SSD swap latency.
- **OLAP Speed:** `AnalyticsDB` (DuckDB) used for time-series aggregations. Vectorized `bulk_insert` is ~100x faster than traditional iterative SQL inserts.
- **TTFT Optimization:** Recommended implementation of Content-Based Prefix Caching for shared agent system prompts (Up to 5.8x reduction in TTFT).

## üõ°Ô∏è Security & Integrity
- **Error Sanitization:** All database and API errors are sanitized at the route level to prevent sensitive string leaks (DB strings, API keys).
- **Validation:** `PriceValidator` refactored to use region-locked providers, preventing cross-contamination during variance checks.
